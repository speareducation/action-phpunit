---
name: Spear PHPUnit Runner
description: A GitHub action to run PHPUnit and record test coverage
branding:
  icon: check-circle
  color: green
runs:
  using: composite
  steps:
    - run: |
        docker network ls
        
        set
        
        cp ${GITHUB_ACTION_PATH}/entrypoint.sh .
        docker run --rm \
          -v $(pwd):/src \
          -w /src \
          --network ${{ inputs.containerNetwork }} \
          -e INPUT_TARGETDIR=${{ inputs.targetDir }} \
          -e SKIP_SECRETS=1 \
          -e SKIP_SERVICES=1 \
          --entrypoint=/src/entrypoint.sh ${{ inputs.dockerImage }}
      shell: bash
inputs:
  containerNetwork:
    description: Network to use when creating the test container
    required: true
  dockerImage:
    description: Name of docker image to use to run tests
    required: true
  targetDir:
    description: Target Directory
    required: true
  options:
    description: Options to append to phpunit command
    required: false
outputs:
  success:
    description: "'true' or 'false'"
    value: ""
  summary:
    description: A short description of the results, including the number of assertions, failures, errors, etc.
    value: ""
  result-text:
    description: "'PASS' or 'FAIL'"
    value: ""
  result-emoji:
    description: A different emoji depending on whether the tests passed or failed.
    value: ""
